<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Anonymous Chatrooms</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #000;
      color: #fff;
    }

    @keyframes glow {
      0%, 100% { filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
      50% { filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.8)); }
    }

    .glow {
      animation: glow 2s ease-in-out infinite;
    }

    .glow-text {
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.4);
    }

    .glow-border {
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.3), inset 0 0 15px rgba(255, 255, 255, 0.1);
    }

    .glow-button {
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.4);
      transition: all 0.3s ease;
    }

    .glow-button:hover {
      box-shadow: 0 0 30px rgba(255, 255, 255, 0.7);
      background: #fff !important;
      color: #000 !important;
    }

    input:focus, textarea:focus {
      outline: none;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
    }

    .message-bubble {
      transition: all 0.3s ease;
    }

    .message-bubble:hover {
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }

    ::-webkit-scrollbar {
      width: 10px;
    }

    ::-webkit-scrollbar-track {
      background: #1a1a1a;
    }

    ::-webkit-scrollbar-thumb {
      background: #fff;
      border-radius: 5px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #ccc;
    }

    .setup-warning {
      background: #2a1a00;
      border: 2px solid #ff9900;
      color: #ffcc66;
      padding: 20px;
      border-radius: 15px;
      margin: 20px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // ============================================
    // üî• FIREBASE CONFIG
    // ============================================
    const firebaseConfig = {
      apiKey: "AIzaSyCR9UiBA6mg3J5a6WGtPK9F76E_ul1D1_c",
      authDomain: "chatroom-60410.firebaseapp.com",
      databaseURL: "https://chatroom-60410-default-rtdb.firebaseio.com",
      projectId: "chatroom-60410",
      storageBucket: "chatroom-60410.firebasestorage.app",
      messagingSenderId: "1074130659134",
      appId: "1:1074130659134:web:06b77a69a0c1d2ee47ee6f",
      measurementId: "G-ENN9HEXNDB"
    };

    // Check if Firebase is configured
    const isFirebaseConfigured = !firebaseConfig.apiKey.includes('YOUR_');

    // Initialize Firebase only if configured
    let db = null;
    if (isFirebaseConfigured) {
      try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.database();
      } catch (error) {
        console.error("Firebase initialization error:", error);
      }
    }

    function MessageCircle() {
      return (
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        </svg>
      );
    }

    function Send() {
      return (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"/>
        </svg>
      );
    }

    function Users() {
      return (
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
        </svg>
      );
    }

    function Plus() {
      return (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
      );
    }

    function Lock() {
      return (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
        </svg>
      );
    }

    function LogOut() {
      return (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
          <polyline points="16 17 21 12 16 7"/>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
      );
    }

    function Trash() {
      return (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <polyline points="3 6 5 6 21 6"/>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
        </svg>
      );
    }

    function SetupInstructions() {
      return (
        <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '20px' }}>
          <div className="setup-warning">
            <h2 style={{ fontSize: '24px', marginBottom: '20px', display: 'flex', alignItems: 'center', gap: '10px' }}>
              ‚ö†Ô∏è Firebase Setup Required
            </h2>
            <p style={{ marginBottom: '20px', lineHeight: '1.6' }}>
              To make this chatroom work across different computers, you need to set up Firebase. Follow these steps:
            </p>
            
            <div style={{ background: '#1a1a1a', padding: '20px', borderRadius: '10px', marginBottom: '20px' }}>
              <h3 style={{ color: '#ffcc66', marginBottom: '15px' }}>üìã Setup Steps:</h3>
              
              <ol style={{ lineHeight: '2', paddingLeft: '20px' }}>
                <li>Go to <a href="https://console.firebase.google.com" target="_blank" style={{ color: '#66ccff' }}>console.firebase.google.com</a></li>
                <li>Click "Add project" and create a new project</li>
                <li>Once created, click "Realtime Database" from the left menu</li>
                <li>Click "Create Database"</li>
                <li>Choose "Start in test mode" (for now)</li>
                <li>Go to Project Settings (gear icon) ‚Üí General</li>
                <li>Scroll down to "Your apps" ‚Üí Click the web icon {"</>"}</li>
                <li>Register your app with a nickname</li>
                <li>Copy the firebaseConfig object</li>
                <li>Replace the firebaseConfig in the code (line 32-39)</li>
              </ol>
            </div>

            <div style={{ background: '#0a0a0a', padding: '15px', borderRadius: '10px', fontSize: '14px', fontFamily: 'monospace', marginBottom: '20px', border: '1px solid #333' }}>
              <div style={{ color: '#888', marginBottom: '10px' }}>// Replace this in your code:</div>
              <pre style={{ color: '#66ff66', margin: 0, whiteSpace: 'pre-wrap' }}>{`const firebaseConfig = {
  apiKey: "AIza...",
  authDomain: "your-app.firebaseapp.com",
  databaseURL: "https://your-app.firebaseio.com",
  projectId: "your-project-id",
  storageBucket: "your-app.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123:web:abc123"
};`}</pre>
            </div>

            <p style={{ fontSize: '14px', opacity: 0.8 }}>
              üí° After setup, redeploy to Vercel and share the URL with your friends!
            </p>
          </div>
        </div>
      );
    }

    function ChatroomApp() {
      const [currentView, setCurrentView] = useState('start');
      const [username, setUsername] = useState('');
      const [tempUsername, setTempUsername] = useState('');
      const [currentRoom, setCurrentRoom] = useState(null);
      const [roomPassword, setRoomPassword] = useState('');
      const [newRoomName, setNewRoomName] = useState('');
      const [newRoomPassword, setNewRoomPassword] = useState('');
      const [message, setMessage] = useState('');
      const [rooms, setRooms] = useState([]);
      const [messages, setMessages] = useState([]);
      const [error, setError] = useState('');
      const [onlineCount, setOnlineCount] = useState(0);
      const messagesEndRef = useRef(null);

      // Show setup instructions if Firebase not configured
      if (!isFirebaseConfigured) {
        return <SetupInstructions />;
      }

      useEffect(() => {
        if (currentView === 'lobby' || currentView === 'create') {
          loadRooms();
          updateOnlineCount();
        }
      }, [currentView]);

      useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      }, [messages]);

      // Real-time listener for messages
      useEffect(() => {
        if (currentRoom && db) {
          const messagesRef = db.ref(`messages/${currentRoom}`);
          
          messagesRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
              const messageList = Object.values(data).sort((a, b) => a.timestamp - b.timestamp);
              setMessages(messageList);
            } else {
              setMessages([]);
            }
          });

          return () => messagesRef.off();
        }
      }, [currentRoom]);

      // Real-time listener for rooms
      useEffect(() => {
        if ((currentView === 'lobby' || currentView === 'create') && db) {
          const roomsRef = db.ref('rooms');
          
          roomsRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
              const roomList = Object.values(data).sort((a, b) => b.createdAt - a.createdAt);
              setRooms(roomList);
            } else {
              setRooms([]);
            }
          });

          return () => roomsRef.off();
        }
      }, [currentView]);

      const updateOnlineCount = () => {
        if (!db) return;
        
        const onlineRef = db.ref('online');
        onlineRef.on('value', (snapshot) => {
          const data = snapshot.val();
          if (data) {
            const now = Date.now();
            const active = Object.values(data).filter(time => now - time < 60000).length;
            setOnlineCount(active);
          } else {
            setOnlineCount(0);
          }
        });
      };

      const markUserOnline = () => {
        if (!username || !db) return;
        
        const userRef = db.ref(`online/${username}`);
        userRef.set(Date.now());
        
        // Set up disconnect handler
        userRef.onDisconnect().remove();
      };

      useEffect(() => {
        if (username && db) {
          markUserOnline();
          const interval = setInterval(markUserOnline, 30000);
          return () => clearInterval(interval);
        }
      }, [username]);

      const loadRooms = () => {
        // Handled by real-time listener
      };

      const createRoom = async () => {
        if (!newRoomName.trim()) {
          setError('Room name required');
          return;
        }
        
        if (!db) {
          setError('Firebase not initialized');
          return;
        }

        const roomId = Date.now().toString();
        const room = {
          id: roomId,
          name: newRoomName.trim(),
          password: newRoomPassword,
          createdAt: Date.now()
        };

        try {
          await db.ref(`rooms/${roomId}`).set(room);
          setNewRoomName('');
          setNewRoomPassword('');
          setError('');
          setCurrentView('lobby');
        } catch (err) {
          setError('Failed to create room: ' + err.message);
        }
      };

      const joinRoom = (room, pwd = null) => {
        const passwordToCheck = pwd || roomPassword;
        
        if (room.password && room.password !== passwordToCheck) {
          setError('Incorrect password');
          return false;
        }
        
        setCurrentRoom(room.id);
        setCurrentView('room');
        setRoomPassword('');
        setError('');
        return true;
      };

      const sendMessage = async () => {
        if (!message.trim() || !currentRoom || !db) return;

        const newMsg = {
          id: Date.now().toString() + Math.random(),
          username,
          text: message.trim(),
          timestamp: Date.now(),
          reactions: {}
        };

        try {
          await db.ref(`messages/${currentRoom}/${newMsg.id}`).set(newMsg);
          setMessage('');
          setError('');
        } catch (err) {
          setError('Failed to send message: ' + err.message);
          console.error('Send error:', err);
        }
      };

      const leaveRoom = () => {
        setCurrentRoom(null);
        setCurrentView('lobby');
        setMessages([]);
      };

      const deleteRoom = async (roomId, e) => {
        e.stopPropagation();
        if (!confirm('Delete this room and all messages?')) return;
        
        if (!db) return;

        try {
          await db.ref(`rooms/${roomId}`).remove();
          await db.ref(`messages/${roomId}`).remove();
        } catch (err) {
          setError('Failed to delete room');
        }
      };

      const addReaction = async (messageId, emoji) => {
        if (!currentRoom || !db || !username) return;
        
        try {
          const reactionRef = db.ref(`messages/${currentRoom}/${messageId}/reactions/${username}`);
          await reactionRef.set(emoji);
        } catch (err) {
          console.error('Failed to add reaction:', err);
        }
      };

      const showReactionPicker = (messageId) => {
        const emojis = ['üëç', '‚ù§Ô∏è', 'üòÇ', 'üòÆ', 'üò¢', 'üî•', 'üéâ', 'üëè'];
        const emoji = prompt(`Pick a reaction:\n${emojis.join(' ')}\n\nType one emoji:`);
        if (emoji && emoji.trim()) {
          addReaction(messageId, emoji.trim());
        }
      };

      const formatTime = (timestamp) => {
        const date = new Date(timestamp);
        return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
      };

      const handleUsernameSubmit = () => {
        if (tempUsername.trim()) {
          setUsername(tempUsername.trim());
          setCurrentView('lobby');
        }
      };

      // Start screen
      if (currentView === 'start') {
        return (
          <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '20px' }}>
            <div className="glow-border" style={{ background: '#0a0a0a', borderRadius: '20px', padding: '40px', width: '100%', maxWidth: '400px', border: '1px solid #333' }}>
              <div style={{ textAlign: 'center', marginBottom: '30px' }}>
                <div className="glow" style={{ display: 'inline-block' }}><MessageCircle /></div>
                <h1 className="glow-text" style={{ fontSize: '32px', fontWeight: 'bold', marginTop: '20px', marginBottom: '10px' }}>CHATROOMS</h1>
                <p style={{ color: '#999' }}>Enter the void</p>
              </div>
              
              <input
                type="text"
                value={tempUsername}
                onChange={(e) => setTempUsername(e.target.value)}
                onKeyDown={(e) => {
                  if (e.key === 'Enter') {
                    e.preventDefault();
                    handleUsernameSubmit();
                  }
                }}
                placeholder="Choose username..."
                style={{ width: '100%', padding: '15px', background: '#1a1a1a', border: '1px solid #333', borderRadius: '10px', color: '#fff', fontSize: '16px', marginBottom: '20px' }}
              />

              <div style={{ display: 'grid', gap: '10px' }}>
                <button
                  onClick={() => {
                    if (tempUsername.trim()) {
                      setUsername(tempUsername.trim());
                      setCurrentView('lobby');
                    } else {
                      setError('Please enter a username');
                    }
                  }}
                  className="glow-button"
                  style={{ width: '100%', background: '#fff', color: '#000', padding: '15px', borderRadius: '10px', border: 'none', fontSize: '16px', fontWeight: 'bold', cursor: 'pointer' }}
                >
                  JOIN ROOM
                </button>
                <button
                  onClick={() => {
                    if (tempUsername.trim()) {
                      setUsername(tempUsername.trim());
                      setCurrentView('create');
                    } else {
                      setError('Please enter a username');
                    }
                  }}
                  className="glow-button"
                  style={{ width: '100%', background: '#1a1a1a', color: '#fff', padding: '15px', borderRadius: '10px', border: '1px solid #333', fontSize: '16px', fontWeight: 'bold', cursor: 'pointer' }}
                >
                  CREATE ROOM
                </button>
              </div>

              {error && (
                <div style={{ background: '#2a0000', border: '1px solid #ff0000', color: '#ff6666', padding: '10px', borderRadius: '10px', marginTop: '15px', fontSize: '14px' }}>
                  {error}
                </div>
              )}
            </div>
          </div>
        );
      }

      // Create Room View
      if (currentView === 'create') {
        return (
          <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '20px' }}>
            <div className="glow-border" style={{ background: '#0a0a0a', borderRadius: '20px', padding: '40px', width: '100%', maxWidth: '500px', border: '1px solid #333' }}>
              <div style={{ textAlign: 'center', marginBottom: '30px' }}>
                <div className="glow" style={{ display: 'inline-block' }}><Plus /></div>
                <h1 className="glow-text" style={{ fontSize: '28px', fontWeight: 'bold', marginTop: '20px', marginBottom: '10px' }}>CREATE ROOM</h1>
                <p style={{ color: '#999' }}>User: {username}</p>
              </div>

              <input
                type="text"
                value={newRoomName}
                onChange={(e) => setNewRoomName(e.target.value)}
                placeholder="Room name..."
                style={{ width: '100%', padding: '15px', background: '#1a1a1a', border: '1px solid #333', borderRadius: '10px', color: '#fff', fontSize: '16px', marginBottom: '15px' }}
              />

              <input
                type="password"
                value={newRoomPassword}
                onChange={(e) => setNewRoomPassword(e.target.value)}
                placeholder="Password (optional)..."
                style={{ width: '100%', padding: '15px', background: '#1a1a1a', border: '1px solid #333', borderRadius: '10px', color: '#fff', fontSize: '16px', marginBottom: '20px' }}
              />

              <div style={{ display: 'grid', gap: '10px' }}>
                <button
                  onClick={createRoom}
                  className="glow-button"
                  style={{ width: '100%', background: '#fff', color: '#000', padding: '15px', borderRadius: '10px', border: 'none', fontSize: '16px', fontWeight: 'bold', cursor: 'pointer' }}
                >
                  CREATE & ENTER
                </button>
                <button
                  onClick={() => setCurrentView('start')}
                  style={{ width: '100%', background: '#1a1a1a', color: '#fff', padding: '15px', borderRadius: '10px', border: '1px solid #333', fontSize: '16px', fontWeight: 'bold', cursor: 'pointer' }}
                >
                  BACK
                </button>
              </div>

              {error && (
                <div style={{ background: '#2a0000', border: '1px solid #ff0000', color: '#ff6666', padding: '15px', borderRadius: '10px', marginTop: '15px' }}>
                  {error}
                </div>
              )}
            </div>
          </div>
        );
      }

      // Lobby View
      if (currentView === 'lobby') {
        return (
          <div style={{ minHeight: '100vh', padding: '20px' }}>
            <div style={{ maxWidth: '900px', margin: '0 auto' }}>
              <div className="glow-border" style={{ background: '#0a0a0a', borderRadius: '20px', padding: '30px', marginBottom: '30px', border: '1px solid #333' }}>
                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '30px', flexWrap: 'wrap', gap: '15px' }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>
                    <div className="glow"><MessageCircle /></div>
                    <h1 className="glow-text" style={{ fontSize: '28px', fontWeight: 'bold' }}>ROOMS</h1>
                  </div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '20px', fontSize: '14px', color: '#999' }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <Users />
                      <span>{onlineCount} online</span>
                    </div>
                    <div>User: <span className="glow-text" style={{ color: '#fff', fontWeight: 'bold' }}>{username}</span></div>
                  </div>
                </div>

                {error && (
                  <div style={{ background: '#2a0000', border: '1px solid #ff0000', color: '#ff6666', padding: '15px', borderRadius: '10px', marginBottom: '20px' }}>
                    {error}
                  </div>
                )}

                <div style={{ marginBottom: '20px' }}>
                  <button
                    onClick={() => setCurrentView('create')}
                    className="glow-button"
                    style={{ background: '#fff', color: '#000', padding: '12px 24px', borderRadius: '8px', border: 'none', fontWeight: 'bold', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '8px' }}
                  >
                    <Plus /> CREATE NEW ROOM
                  </button>
                </div>

                <div>
                  {rooms.length === 0 ? (
                    <div style={{ textAlign: 'center', padding: '60px 20px', color: '#666' }}>
                      <div className="glow" style={{ display: 'inline-block', marginBottom: '15px' }}><Users /></div>
                      <p>No rooms available. Create one!</p>
                    </div>
                  ) : (
                    <div style={{ display: 'grid', gap: '10px' }}>
                      {rooms.map((room) => (
                        <div
                          key={room.id}
                          className="glow-border"
                          onClick={() => {
                            if (room.password) {
                              const pwd = prompt('Enter room password:');
                              if (pwd) {
                                joinRoom(room, pwd);
                              }
                            } else {
                              joinRoom(room);
                            }
                          }}
                          style={{ background: '#1a1a1a', borderRadius: '10px', padding: '20px', border: '1px solid #2a2a2a', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'space-between', transition: 'all 0.3s' }}
                        >
                          <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>
                            {room.password && <Lock />}
                            <div>
                              <h3 className="glow-text" style={{ fontWeight: 'bold', marginBottom: '5px' }}>{room.name}</h3>
                              <p style={{ fontSize: '14px', color: '#666' }}>
                                Created {new Date(room.createdAt).toLocaleDateString()}
                              </p>
                            </div>
                          </div>
                          <button
                            onClick={(e) => deleteRoom(room.id, e)}
                            style={{ padding: '10px', background: 'transparent', border: 'none', color: '#ff4444', cursor: 'pointer' }}
                          >
                            <Trash />
                          </button>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>
        );
      }

      // Chat Room View
      const currentRoomData = rooms.find(r => r.id === currentRoom);
      
      return (
        <div style={{ minHeight: '100vh', padding: '20px' }}>
          <div style={{ maxWidth: '900px', margin: '0 auto', height: 'calc(100vh - 40px)', display: 'flex', flexDirection: 'column' }}>
            <div className="glow-border" style={{ background: '#0a0a0a', borderRadius: '20px 20px 0 0', padding: '20px', display: 'flex', alignItems: 'center', justifyContent: 'space-between', border: '1px solid #333', borderBottom: 'none' }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>
                <div className="glow"><MessageCircle /></div>
                <div>
                  <h2 className="glow-text" style={{ fontWeight: 'bold' }}>{currentRoomData?.name}</h2>
                  <p style={{ fontSize: '14px', color: '#666' }}>as {username}</p>
                </div>
              </div>
              <button
                onClick={leaveRoom}
                className="glow-button"
                style={{ display: 'flex', alignItems: 'center', gap: '10px', padding: '10px 20px', background: '#1a1a1a', border: '1px solid #333', borderRadius: '8px', color: '#fff', cursor: 'pointer' }}
              >
                <LogOut /> LEAVE
              </button>
            </div>

            <div className="glow-border" style={{ background: '#0a0a0a', flex: 1, overflowY: 'auto', padding: '20px', border: '1px solid #333', borderTop: 'none', borderBottom: 'none' }}>
              {messages.length === 0 ? (
                <div style={{ textAlign: 'center', padding: '60px 20px', color: '#666' }}>
                  <div className="glow" style={{ display: 'inline-block', marginBottom: '15px' }}><MessageCircle /></div>
                  <p>No messages yet. Start the conversation!</p>
                </div>
              ) : (
                <div style={{ display: 'flex', flexDirection: 'column', gap: '15px' }}>
                  {messages.map((msg) => {
                    const reactions = msg.reactions || {};
                    const reactionCounts = {};
                    Object.values(reactions).forEach(emoji => {
                      reactionCounts[emoji] = (reactionCounts[emoji] || 0) + 1;
                    });
                    
                    return (
                      <div
                        key={msg.id}
                        style={{ display: 'flex', justifyContent: msg.username === username ? 'flex-end' : 'flex-start' }}
                      >
                        <div style={{ maxWidth: '70%' }}>
                          <div
                            className="message-bubble"
                            onClick={() => showReactionPicker(msg.id)}
                            style={{
                              borderRadius: '15px',
                              padding: '12px 18px',
                              background: msg.username === username ? '#fff' : '#1a1a1a',
                              color: msg.username === username ? '#000' : '#fff',
                              border: msg.username === username ? 'none' : '1px solid #2a2a2a',
                              cursor: 'pointer'
                            }}
                          >
                            <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '5px' }}>
                              <span style={{ fontWeight: 'bold', fontSize: '14px' }}>{msg.username}</span>
                              <span style={{ fontSize: '12px', opacity: 0.6 }}>{formatTime(msg.timestamp)}</span>
                            </div>
                            <p style={{ wordBreak: 'break-word', margin: 0 }}>{msg.text}</p>
                          </div>
                          
                          {Object.keys(reactionCounts).length > 0 && (
                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '5px', marginTop: '5px', justifyContent: msg.username === username ? 'flex-end' : 'flex-start' }}>
                              {Object.entries(reactionCounts).map(([emoji, count]) => (
                                <div
                                  key={emoji}
                                  style={{
                                    background: '#1a1a1a',
                                    border: '1px solid #333',
                                    borderRadius: '12px',
                                    padding: '4px 10px',
                                    fontSize: '14px',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '5px'
                                  }}
                                >
                                  <span>{emoji}</span>
                                  <span style={{ fontSize: '12px', color: '#999' }}>{count}</span>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>
                    );
                  })}
                  <div ref={messagesEndRef} />
                </div>
              )}
            </div>

            <div className="glow-border" style={{ background: '#0a0a0a', borderRadius: '0 0 20px 20px', padding: '20px', border: '1px solid #333', borderTop: 'none' }}>
              <div style={{ display: 'flex', gap: '10px' }}>
                <input
                  type="text"
                  value={message}
                  onChange={(e) => setMessage(e.target.value)}
                  onKeyDown={(e) => {
                    if (e.key === 'Enter') {
                      e.preventDefault();
                      sendMessage();
                    }
                  }}
                  placeholder="Type a message..."
                  style={{ flex: 1, padding: '15px', background: '#1a1a1a', border: '1px solid #333', borderRadius: '10px', color: '#fff', fontSize: '16px' }}
                />
                <button
                  onClick={sendMessage}
                  className="glow-button"
                  style={{ background: '#fff', color: '#000', padding: '15px 30px', borderRadius: '10px', border: 'none', fontWeight: 'bold', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '10px' }}
                >
                  <Send /> SEND
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<ChatroomApp />, document.getElementById('root'));
  </script>
</body>
</html>
